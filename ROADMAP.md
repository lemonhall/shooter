# 自由枪骑兵复刻开发计划

## 项目目标
复刻《自由枪骑兵》（Freelancer）的宇宙战斗部分，实现经典的太空飞行战斗体验。

---

## 核心机制参考

### 原作操作系统
- **鼠标控制飞行** - 鼠标移动控制飞船转向（核心机制）
- **左键射击** - 主武器连射
- **右键/导弹** - 副武器/锁定导弹
- **空格加速** - 引擎推进加速
- **Z键减速** - 刹车/反推
- **Tab切换目标** - 自动锁定最近敌人
- **自动瞄准辅助** - 轻微的瞄准辅助

### 敌人AI特征
1. **环绕攻击** - 敌人绕着玩家做圆周运动
2. **侧向机动** - 横向躲避射击
3. **距离保持** - 保持在有效射程内（500-1000米）
4. **编队作战** - 2-4架敌机协同攻击
5. **撤退机制** - 护盾低于30%时后退

### 视觉反馈
- 护盾闪烁效果（被击中时）
- 引擎尾焰粒子
- 能量武器轨迹
- 爆炸碎片特效
- HUD雷达和锁定框

---

## 开发阶段

### ✅ 阶段 0：基础框架（已完成）
- [x] Three.js 集成
- [x] 基础场景渲染
- [x] 简单的WASD控制
- [x] 基础碰撞检测
- [x] HUD界面
- [x] 音效系统

---

### 🚀 阶段 1：基础飞行系统（优先级：高）

**目标：** 实现鼠标控制的太空飞行

#### 1.1 鼠标飞行控制
- [ ] 鼠标位置映射到飞船朝向
- [ ] 平滑转向插值（避免突兀）
- [ ] 飞船Roll轴倾斜效果
- [ ] 移除WASD键盘控制

#### 1.2 惯性与物理
- [ ] 持续前进速度
- [ ] 空格键加速系统
- [ ] Z键减速/刹车
- [ ] 速度阻尼（真空环境模拟）
- [ ] 最大/最小速度限制

#### 1.3 相机系统
- [ ] 第三人称跟随相机
- [ ] 相机平滑跟随
- [ ] 可选：相机shake效果（被击中时）

#### 1.4 环境优化
- [ ] 星空背景滚动
- [ ] 星云/星系背景
- [ ] 小行星点缀（非碰撞）

**预计时间：** 2-3天

---

### 🔫 阶段 2：武器系统升级（优先级：高）

**目标：** 多样化的武器和更好的射击体验

#### 2.1 武器类型
- [ ] 能量武器（激光）
  - 高射速，低伤害
  - 直线弹道
- [ ] 等离子炮
  - 中射速，中伤害
  - 轻微弧线弹道
- [ ] 导弹系统（第二阶段后期）
  - 锁定目标
  - 追踪飞行

#### 2.2 射击机制
- [ ] 武器冷却系统
- [ ] 能量条（限制连射）
- [ ] 武器切换（1/2/3键）
- [ ] 弹道轨迹粒子效果
- [ ] 不同武器音效

#### 2.3 瞄准系统
- [ ] 准星UI
- [ ] 预测瞄准（前置量）
- [ ] 轻微自动瞄准辅助

**预计时间：** 2-3天

---

### 🤖 阶段 3：敌人AI系统（优先级：高）

**目标：** 智能且有挑战性的敌人

#### 3.1 基础AI行为
- [ ] 环绕飞行算法
  - 计算玩家周围圆形轨迹
  - 随机半径（600-1200米）
  - 顺/逆时针随机
- [ ] 距离控制
  - 太近时后退
  - 太远时靠近
- [ ] 面向玩家（朝向计算）

#### 3.2 战斗AI
- [ ] 射击判定
  - 在射程内才开火
  - 瞄准玩家当前位置
- [ ] 躲避逻辑
  - 检测玩家射击方向
  - 横向机动躲避
- [ ] 护盾系统
  - 护盾条显示
  - 被击中护盾减少
  - 护盾耗尽后生命值

#### 3.3 高级AI
- [ ] 不同敌人类型
  - 轻型战机（快速，脆弱）
  - 重型战机（慢速，坚固）
- [ ] 撤退机制
  - 生命值低于30%时逃跑
- [ ] 编队系统（后期）

**预计时间：** 3-4天

---

### 💥 阶段 4：战斗反馈（优先级：中）

**目标：** 增强视觉和交互反馈

#### 4.1 护盾系统
- [ ] 护盾可视化
  - 半透明球体
  - 被击中时闪烁
  - 颜色随强度变化
- [ ] 护盾充能动画
- [ ] 护盾破碎效果

#### 4.2 特效系统
- [ ] 引擎尾焰粒子
  - 加速时变强
  - 减速时变弱
- [ ] 爆炸效果升级
  - 碎片飞溅
  - 火焰扩散
  - 冲击波
- [ ] 武器发射光效
- [ ] 命中火花

#### 4.3 HUD升级
- [ ] 雷达系统
  - 显示敌人位置
  - 区分友军/敌军
- [ ] 目标锁定框
  - 锁定当前目标
  - 显示敌人血量
- [ ] 速度表
- [ ] 武器/护盾状态条

#### 4.4 音效增强
- [ ] 引擎轰鸣声（循环）
- [ ] 护盾被击中音效
- [ ] 爆炸音效
- [ ] 背景音乐

**预计时间：** 3-4天

---

### 🌟 阶段 5：进阶功能（优先级：中低）

**目标：** 更接近原作的完整体验

#### 5.1 编队系统
- [ ] 多敌人协同
- [ ] 编队飞行阵型
- [ ] 队长跟随机制

#### 5.2 场景丰富化
- [ ] 小行星带
  - 碰撞检测
  - 遮蔽物利用
- [ ] 空间站
  - 背景装饰
  - 可选：可摧毁炮塔
- [ ] 母舰/大型飞船

#### 5.3 任务系统
- [ ] 波次进攻
  - 清空一波生成下一波
  - 难度递增
- [ ] 任务目标
  - 歼灭所有敌人
  - 护送目标
  - 摧毁基地

#### 5.4 升级系统
- [ ] 武器升级
  - 伤害提升
  - 射速提升
- [ ] 护盾升级
- [ ] 引擎升级（速度）
- [ ] 升级商店UI

**预计时间：** 5-7天

---

### 🎨 阶段 6：打磨优化（优先级：低）

**目标：** 提升整体质量

#### 6.1 性能优化
- [ ] 对象池（减少GC）
- [ ] LOD系统（远处简化模型）
- [ ] 粒子数量控制

#### 6.2 视觉优化
- [ ] 后期处理
  - Bloom（辉光）
  - 色彩校正
- [ ] 更精细的模型
  - 飞船模型（非方块）
  - 武器模型

#### 6.3 用户体验
- [ ] 暂停菜单
- [ ] 设置界面
  - 音量控制
  - 灵敏度调节
- [ ] 教程/新手引导
- [ ] 存档系统

**预计时间：** 3-5天

---

## 技术实现要点

### 鼠标飞行控制算法
```javascript
// 获取鼠标相对屏幕中心的偏移
const deltaX = (mouseX / screenWidth - 0.5) * 2;
const deltaY = (mouseY / screenHeight - 0.5) * 2;

// 计算目标旋转角度
const targetRotationY = -deltaX * Math.PI / 4; // 左右
const targetRotationX = -deltaY * Math.PI / 4; // 上下

// 平滑插值到目标角度
ship.rotation.y = lerp(ship.rotation.y, targetRotationY, 0.1);
ship.rotation.x = lerp(ship.rotation.x, targetRotationX, 0.1);

// Roll倾斜效果（模拟转弯）
ship.rotation.z = -deltaX * Math.PI / 6;
```

### 敌人环绕算法
```javascript
// 计算环绕轨迹
const orbitRadius = 800; // 环绕半径
const orbitSpeed = 0.02; // 环绕速度

enemy.orbitAngle += orbitSpeed;

// 更新位置（以玩家为中心的圆形轨迹）
enemy.position.x = player.position.x + Math.cos(enemy.orbitAngle) * orbitRadius;
enemy.position.z = player.position.z + Math.sin(enemy.orbitAngle) * orbitRadius;

// 面向玩家
enemy.lookAt(player.position);
```

### 惯性系统
```javascript
// 速度累加（不是直接设置位置）
const acceleration = 2.0;
const drag = 0.98; // 阻尼系数

if (isAccelerating) {
    velocity += acceleration;
}
velocity = Math.min(velocity, maxSpeed);
velocity *= drag;

// 根据速度更新位置
const forward = ship.getWorldDirection(new THREE.Vector3());
ship.position.add(forward.multiplyScalar(velocity));
```

---

## 当前状态

### 已完成
- ✅ 基础Three.js场景
- ✅ WASD键盘控制
- ✅ 简单射击机制
- ✅ 基础碰撞检测
- ✅ HUD显示（生命、分数、击杀）
- ✅ 粒子爆炸效果
- ✅ 音效支持

### 下一步（阶段1）
1. 实现鼠标飞行控制
2. 添加惯性系统
3. 优化相机跟随
4. 升级星空背景

---

## 开发时间估算

| 阶段 | 功能 | 预计时间 | 优先级 |
|------|------|----------|--------|
| 阶段1 | 基础飞行系统 | 2-3天 | 高 |
| 阶段2 | 武器系统升级 | 2-3天 | 高 |
| 阶段3 | 敌人AI系统 | 3-4天 | 高 |
| 阶段4 | 战斗反馈 | 3-4天 | 中 |
| 阶段5 | 进阶功能 | 5-7天 | 中低 |
| 阶段6 | 打磨优化 | 3-5天 | 低 |

**总计：** 18-26天（按每天2-3小时计算）

---

## 参考资源

### 游戏设计
- Freelancer 游戏视频
- 太空飞行游戏设计文档

### 技术参考
- Three.js 官方文档
- 太空飞行物理模拟
- AI行为树设计

---

## 更新日志

### 2025-10-27
- 创建开发计划文档
- 定义6个开发阶段
- 制定技术实现方案
